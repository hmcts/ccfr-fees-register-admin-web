{% extends "layout.njk" %}

{% set title = t('Category | Fees Register Admin Console') %}
{% set heading = t('Category') %}

{% block content %}

{% macro penniesAsPounds(amount) %}
  {% if amount === 0 %}
    £0 {# special case as (0).toLocaleString() is not working as expected #}
  {% elif amount > 0 %}
    £{{ (amount / 100.0 + 0.00).toLocaleString() }}
  {% endif %}
{% endmacro %}

{% macro feeAmount(fee) %}
  {% if fee.type == 'fixed' %}
    {{ penniesAsPounds(fee.amount) }}
  {% elif fee.type == 'percentage' %}
    {{ fee.percentage }}%
  {% else %}
    Unknown fee type
  {% endif %}
{% endmacro %}

<div class="grid-row">
  <div class="column-full">
    <h3 class="heading-medium">Id</h3>
    {{ category.id }}
    <h3 class="heading-medium">Code</h3>
    {{ category.code }}
    <h3 class="heading-medium">Description</h3>
    {{ category.description }}
    <h3 class="heading-medium">Range Group</h3>
    {% if category.ranges.length > 0 %}
      <table>
        <thead>
          <tr>
            <th scope="col">{{ t('Range') }}</th>
            <th scope="col">{{ t('Fee Code') }}</th>
            <th scope="col">{{ t('Fee Amount') }}</th>
          </tr>
        </thead>
        <tbody>
          {% for range in category.ranges %}
            <tr>
              <td>{{ penniesAsPounds(range.from) }} - {{ penniesAsPounds(range.to) }}</td>
              <td>{{ range.fee.code }}</td>
              <td>{{ feeAmount(range.fee) }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      Category has no range group defined
    {% endif %}

    <h3 class="heading-medium">Flat Fees</h3>
    {% if category.fees.length > 0 %}
      <table>
        <thead>
          <tr>
            <th scope="col">{{ t('Code') }}</th>
            <th scope="col">{{ t('Description') }}</th>
            <th scope="col">{{ t('Amount') }}</th>
          </tr>
        </thead>
        <tbody>
          {% for fee in category.fees %}
            <tr>
              <td>{{ fee.code }}</td>
              <td>{{ fee.description }}</td>
              <td>{{ feeAmount(fee) }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      Category has no fees defined
    {% endif %}

    <p><a class="button" href="/admin/categories" role="button">{{ t("Cancel") }}</a></p>
  </div>
</div>


{% endblock %}
