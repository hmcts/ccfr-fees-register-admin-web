{% extends "layout.njk" %}
{% from "includes/macros/form.njk" import nextButton%}

{% set title = t('Fees | ' + serviceName) %}
{% block content %}
    {% if isApprover(user.allInfo.roles) %}
        <input type='hidden' id='userRole' value='Approver'/>
    {% else %}
        <input type='hidden' id='userRole' value='Editor'/>
    {% endif %}
	<ul class="govuk-tabs__list govuk-!-margin-top-8">

		<li class="govuk-tabs__list-item govuk-tabs__list-item--selected">
			<a class="govuk-tabs__tab govuk-tabs__tab--selected" href="./draft-fees" style="text-decoration: underline;">
				{{ t("Drafts") }}
			</a>
		</li>

		<li class="govuk-tabs__list-item">
			<a class="govuk-tabs__tab" href="./draft-rejectedbyapprover" style="text-decoration: underline;">
				{{ t("Rejected by approver") }}
			</a>
		</li>
		<li class="govuk-tabs__list-item">
			<a class="govuk-tabs__tab" href="./draft-awaitingapproval" style="text-decoration: underline;">
				{{ t("Awaiting approval") }}
			</a>
		</li>
	</ul>

	<div class="govuk-tabs__panel" id="past-day">
		<div class="container">
			<div class="row">

				<div class="title-with-secondary">
					<h1 class="heading">{{t("Drafts")}}</h1>
					<div class="title-with-secondary" style="flex-grow: 1;"></div>
					<a href="./fees/create">{{nextButton(t("Create a new fee"), t("govuk-button2 black-text"))}}</a>
				</div>
				{% if (fees | length) > 0 %}
					<table class="govuk-table">
						<thead class="govuk-table__head font-16">
							<tr class="govuk-table__row">
								<th class="govuk-table__header" scope="col" style="width: 60px;">Code</th>
								<th class="govuk-table__header" scope="col" style="width:84px; text-align: right; padding-right: 20px;">Amount</th>
								<th class="govuk-table__header" scope="col" style="width: 120px;">Service</th>
								<th class="govuk-table__header" scope="col" style="width: 200px;">Description</th>
								<th class="govuk-table__header" scope="col" style="width: 100px;">Statutory Instrument</th>
								<th class="govuk-table__header" scope="col" style="width:100px;">Valid from</th>
								<th class="govuk-table__header" scope="col" style="width:40px;"></th>
							</tr>
						</thead>
						<tbody>
						{% set isApprovedDraft = false %}
							{% for fee in fees %}
								{% if fee.current_version != null %}
									{% set version = fee.current_version %}
								{% else %}
									{% set version = fee.fee_versions[0] %}
								{% endif %}

								{% if version.approvedBy == null %}
								   {% set isApprovedDraft = true %}
									<tr>
										<td data-label="Code" class="padding10 whitespace-inherit">{{ fee.code }}</td>
										{% if version.flat_amount %}
											<td  class="padding20 whitespace-inherit" >£{{ version.flat_amount.amount.toFixed(2).toString()}}</td>
										{% elif version.volume_amount %}
											<td class="padding20 whitespace-inherit">£{{ version.volume_amount.amount.toFixed(2).toString()}}</td>
										{% else %}
											<td class="padding20 whitespace-inherit">{{ version.percentage_amount.percentage }}%</td>
										{% endif %}

										<td data-label="Service" class="padding10 whitespace-inherit">{{ fee.service_type.name }}</td>

										<td data-label="Jurisdiction 2" class="padding10 whitespace-inherit">{{ version.description }}</td>

										<td data-label="Description" class="padding10 whitespace-inherit">{{ version.statutory_instrument }}</td>

										{% if version.valid_from %}
											<td class="padding20 alignleft whitespace-inherit" >{{ version.valid_from | date("DD MMMM YYYY") }}</td>
										{% else %}
											<td/>
										{% endif %}

										<td >
											{% if user %}
												<a href="/admin/V2/fee-details?draft=true&feeCode={{ fee.code }}&pageType=draftfee&vno={{version.version}}">View</a>
											{% else  %}
												<a href="/admin/V2/fee-details?draft=true&feeCode={{ fee.code }}&pageType=draftfee">View</a>
											{% endif %}
										</td>
									</tr>
							    {% endif %}

								{% endfor %}
								{% if isApprovedDraft == false %}
								<tr>
									<td colspan='7'> 
									No draft fees.
									</td>
								</tr>
								{% endif %}
							</tbody>
						</table>
					{% else %}
						<p>No draft fees.</p>
					{% endif %}

				</div>
			</div>

		{% endblock %}